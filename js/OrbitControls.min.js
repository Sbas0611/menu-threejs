import{EventDispatcher as a,MOUSE as b,Quaternion as c,Spherical as d,TOUCH as e,Vector2 as f,Vector3 as g}from"./three.module.js";let _changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"};class OrbitControls extends a{constructor(i,h){super(),void 0===h&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),h===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=i,this.domElement=h,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new g,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:b.ROTATE,MIDDLE:b.DOLLY,RIGHT:b.PAN},this.touches={ONE:e.ROTATE,TWO:e.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return q.phi},this.getAzimuthalAngle=function(){return q.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(a){a.addEventListener("keydown",aj),this._domElementKeyEvents=a},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(_changeEvent),a.update(),o=j.NONE},this.update=function(){let d=new g,b=new c().setFromUnitVectors(i.up,new g(0,1,0)),e=b.clone().invert(),f=new g,h=new c,k=2*Math.PI;return function(){let i=a.object.position;d.copy(i).sub(a.target),d.applyQuaternion(b),q.setFromVector3(d),a.autoRotate&&o===j.NONE&&I(G()),a.enableDamping?(q.theta+=r.theta*a.dampingFactor,q.phi+=r.phi*a.dampingFactor):(q.theta+=r.theta,q.phi+=r.phi);let c=a.minAzimuthAngle,g=a.maxAzimuthAngle;return isFinite(c)&&isFinite(g)&&(c< -Math.PI?c+=k:c>Math.PI&&(c-=k),g< -Math.PI?g+=k:g>Math.PI&&(g-=k),c<=g?q.theta=Math.max(c,Math.min(g,q.theta)):q.theta=q.theta>(c+g)/2?Math.max(c,q.theta):Math.min(g,q.theta)),q.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,q.phi)),q.makeSafe(),q.radius*=s,q.radius=Math.max(a.minDistance,Math.min(a.maxDistance,q.radius)),!0===a.enableDamping?a.target.addScaledVector(t,a.dampingFactor):a.target.add(t),d.setFromSpherical(q),d.applyQuaternion(e),i.copy(a.target).add(d),a.object.lookAt(a.target),!0===a.enableDamping?(r.theta*=1-a.dampingFactor,r.phi*=1-a.dampingFactor,t.multiplyScalar(1-a.dampingFactor)):(r.set(0,0,0),t.set(0,0,0)),s=1,!!(u||f.distanceToSquared(a.object.position)>p||8*(1-h.dot(a.object.quaternion))>p)&&(a.dispatchEvent(_changeEvent),f.copy(a.object.position),h.copy(a.object.quaternion),u=!1,!0)}}(),this.dispose=function(){a.domElement.removeEventListener("contextmenu",n),a.domElement.removeEventListener("pointerdown",k),a.domElement.removeEventListener("pointercancel",l),a.domElement.removeEventListener("wheel",m),a.domElement.removeEventListener("pointermove",af),a.domElement.removeEventListener("pointerup",ag),null!==a._domElementKeyEvents&&a._domElementKeyEvents.removeEventListener("keydown",aj)};let a=this,j={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},o=j.NONE,p=1e-6,q=new d,r=new d,s=1,t=new g,u=!1,v=new f,w=new f,x=new f,y=new f,z=new f,A=new f,B=new f,C=new f,D=new f,E=[],F={};function G(){return 2*Math.PI/60/60*a.autoRotateSpeed}function H(){return Math.pow(.95,a.zoomSpeed)}function I(a){r.theta-=a}function J(a){r.phi-=a}let K=function(){let a=new g;return function(b,c){a.setFromMatrixColumn(c,0),a.multiplyScalar(-b),t.add(a)}}(),L=function(){let b=new g;return function(d,c){!0===a.screenSpacePanning?b.setFromMatrixColumn(c,1):(b.setFromMatrixColumn(c,0),b.crossVectors(a.object.up,b)),b.multiplyScalar(d),t.add(b)}}(),M=function(){let b=new g;return function(d,e){let c=a.domElement;if(a.object.isPerspectiveCamera){let g=a.object.position;b.copy(g).sub(a.target);let f=b.length();K(2*d*(f*=Math.tan(a.object.fov/2*Math.PI/180))/c.clientHeight,a.object.matrix),L(2*e*f/c.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(K(d*(a.object.right-a.object.left)/a.object.zoom/c.clientWidth,a.object.matrix),L(e*(a.object.top-a.object.bottom)/a.object.zoom/c.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function N(b){a.object.isPerspectiveCamera?s/=b:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*b)),a.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function O(b){a.object.isPerspectiveCamera?s*=b:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/b)),a.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function P(a){v.set(a.clientX,a.clientY)}function Q(a){B.set(a.clientX,a.clientY)}function R(a){y.set(a.clientX,a.clientY)}function S(b){w.set(b.clientX,b.clientY),x.subVectors(w,v).multiplyScalar(a.rotateSpeed);let c=a.domElement;I(2*Math.PI*x.x/c.clientHeight),J(2*Math.PI*x.y/c.clientHeight),v.copy(w),a.update()}function T(b){C.set(b.clientX,b.clientY),D.subVectors(C,B),D.y>0?N(H()):D.y<0&&O(H()),B.copy(C),a.update()}function U(b){z.set(b.clientX,b.clientY),A.subVectors(z,y).multiplyScalar(a.panSpeed),M(A.x,A.y),y.copy(z),a.update()}function V(b){b.deltaY<0?O(H()):b.deltaY>0&&N(H()),a.update()}function W(c){let b=!1;switch(c.code){case a.keys.UP:M(0,a.keyPanSpeed),b=!0;break;case a.keys.BOTTOM:M(0,-a.keyPanSpeed),b=!0;break;case a.keys.LEFT:M(a.keyPanSpeed,0),b=!0;break;case a.keys.RIGHT:M(-a.keyPanSpeed,0),b=!0}b&&(c.preventDefault(),a.update())}function X(){if(1===E.length)v.set(E[0].pageX,E[0].pageY);else{let a=.5*(E[0].pageX+E[1].pageX),b=.5*(E[0].pageY+E[1].pageY);v.set(a,b)}}function Y(){if(1===E.length)y.set(E[0].pageX,E[0].pageY);else{let a=.5*(E[0].pageX+E[1].pageX),b=.5*(E[0].pageY+E[1].pageY);y.set(a,b)}}function Z(){let a=E[0].pageX-E[1].pageX,b=E[0].pageY-E[1].pageY;B.set(0,Math.sqrt(a*a+b*b))}function $(){a.enableZoom&&Z(),a.enablePan&&Y()}function _(){a.enableZoom&&Z(),a.enableRotate&&X()}function aa(b){if(1==E.length)w.set(b.pageX,b.pageY);else{let c=ap(b),e=.5*(b.pageX+c.x),f=.5*(b.pageY+c.y);w.set(e,f)}x.subVectors(w,v).multiplyScalar(a.rotateSpeed);let d=a.domElement;I(2*Math.PI*x.x/d.clientHeight),J(2*Math.PI*x.y/d.clientHeight),v.copy(w)}function ab(b){if(1===E.length)z.set(b.pageX,b.pageY);else{let c=ap(b),d=.5*(b.pageX+c.x),e=.5*(b.pageY+c.y);z.set(d,e)}A.subVectors(z,y).multiplyScalar(a.panSpeed),M(A.x,A.y),y.copy(z)}function ac(b){let c=ap(b),d=b.pageX-c.x,e=b.pageY-c.y;C.set(0,Math.sqrt(d*d+e*e)),D.set(0,Math.pow(C.y/B.y,a.zoomSpeed)),N(D.y),B.copy(C)}function ad(b){a.enableZoom&&ac(b),a.enablePan&&ab(b)}function ae(b){a.enableZoom&&ac(b),a.enableRotate&&aa(b)}function k(b){!1!==a.enabled&&(0===E.length&&(a.domElement.setPointerCapture(b.pointerId),a.domElement.addEventListener("pointermove",af),a.domElement.addEventListener("pointerup",ag)),am(b),"touch"===b.pointerType?ak(b):ah(b))}function af(b){!1!==a.enabled&&("touch"===b.pointerType?al(b):ai(b))}function ag(b){an(b),0===E.length&&(a.domElement.releasePointerCapture(b.pointerId),a.domElement.removeEventListener("pointermove",af),a.domElement.removeEventListener("pointerup",ag)),a.dispatchEvent(_endEvent),o=j.NONE}function l(a){an(a)}function ah(c){let d;switch(c.button){case 0:d=a.mouseButtons.LEFT;break;case 1:d=a.mouseButtons.MIDDLE;break;case 2:d=a.mouseButtons.RIGHT;break;default:d=-1}switch(d){case b.DOLLY:if(!1===a.enableZoom)return;Q(c),o=j.DOLLY;break;case b.ROTATE:if(c.ctrlKey||c.metaKey||c.shiftKey){if(!1===a.enablePan)return;R(c),o=j.PAN}else{if(!1===a.enableRotate)return;P(c),o=j.ROTATE}break;case b.PAN:if(c.ctrlKey||c.metaKey||c.shiftKey){if(!1===a.enableRotate)return;P(c),o=j.ROTATE}else{if(!1===a.enablePan)return;R(c),o=j.PAN}break;default:o=j.NONE}o!==j.NONE&&a.dispatchEvent(_startEvent)}function ai(b){if(!1!==a.enabled)switch(o){case j.ROTATE:if(!1===a.enableRotate)return;S(b);break;case j.DOLLY:if(!1===a.enableZoom)return;T(b);break;case j.PAN:if(!1===a.enablePan)return;U(b)}}function m(b){!1!==a.enabled&& !1!==a.enableZoom&&o===j.NONE&&(b.preventDefault(),a.dispatchEvent(_startEvent),V(b),a.dispatchEvent(_endEvent))}function aj(b){!1!==a.enabled&& !1!==a.enablePan&&W(b)}function ak(b){switch(ao(b),E.length){case 1:switch(a.touches.ONE){case e.ROTATE:if(!1===a.enableRotate)return;X(),o=j.TOUCH_ROTATE;break;case e.PAN:if(!1===a.enablePan)return;Y(),o=j.TOUCH_PAN;break;default:o=j.NONE}break;case 2:switch(a.touches.TWO){case e.DOLLY_PAN:if(!1===a.enableZoom&& !1===a.enablePan)return;$(),o=j.TOUCH_DOLLY_PAN;break;case e.DOLLY_ROTATE:if(!1===a.enableZoom&& !1===a.enableRotate)return;_(),o=j.TOUCH_DOLLY_ROTATE;break;default:o=j.NONE}break;default:o=j.NONE}o!==j.NONE&&a.dispatchEvent(_startEvent)}function al(b){switch(ao(b),o){case j.TOUCH_ROTATE:if(!1===a.enableRotate)return;aa(b),a.update();break;case j.TOUCH_PAN:if(!1===a.enablePan)return;ab(b),a.update();break;case j.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&& !1===a.enablePan)return;ad(b),a.update();break;case j.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&& !1===a.enableRotate)return;ae(b),a.update();break;default:o=j.NONE}}function n(b){!1!==a.enabled&&b.preventDefault()}function am(a){E.push(a)}function an(b){delete F[b.pointerId];for(let a=0;a<E.length;a++)if(E[a].pointerId==b.pointerId){E.splice(a,1);return}}function ao(a){let b=F[a.pointerId];void 0===b&&(b=new f,F[a.pointerId]=b),b.set(a.pageX,a.pageY)}function ap(a){let b=a.pointerId===E[0].pointerId?E[1]:E[0];return F[b.pointerId]}a.domElement.addEventListener("contextmenu",n),a.domElement.addEventListener("pointerdown",k),a.domElement.addEventListener("pointercancel",l),a.domElement.addEventListener("wheel",m,{passive:!1}),this.update()}}class MapControls extends OrbitControls{constructor(a,c){super(a,c),this.screenSpacePanning=!1,this.mouseButtons.LEFT=b.PAN,this.mouseButtons.RIGHT=b.ROTATE,this.touches.ONE=e.PAN,this.touches.TWO=e.DOLLY_ROTATE}}export{OrbitControls,MapControls}