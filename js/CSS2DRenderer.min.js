import{Matrix4 as b,Object3D as c,Vector3 as a}from"./three.module.js";class CSS2DObject extends c{constructor(a=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=a,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(a){a.element instanceof Element&&null!==a.element.parentNode&&a.element.parentNode.removeChild(a.element)})})}copy(a,b){return super.copy(a,b),this.element=a.element.cloneNode(!0),this}}let _vector=new a,_viewMatrix=new b,_viewProjectionMatrix=new b,_a=new a,_b=new a;class CSS2DRenderer{constructor(a={}){let c=this,d,e,f,g,h={objects:new WeakMap},b=void 0!==a.element?a.element:document.createElement("div");function i(a,e,d){if(a.isCSS2DObject){_vector.setFromMatrixPosition(a.matrixWorld),_vector.applyMatrix4(_viewProjectionMatrix);let m=!0===a.visible&&_vector.z>= -1&&_vector.z<=1&& !0===a.layers.test(d.layers);if(a.element.style.display=!0===m?"":"none",!0===m){a.onBeforeRender(c,e,d);let k=a.element;k.style.transform="translate(-50%,-50%) translate("+(_vector.x*f+f)+"px,"+(-_vector.y*g+g)+"px)",k.parentNode!==b&&b.appendChild(k),a.onAfterRender(c,e,d)}let n={distanceToCameraSquared:j(d,a)};h.objects.set(a,n)}for(let l=0,o=a.children.length;l<o;l++)i(a.children[l],e,d)}function j(a,b){return _a.setFromMatrixPosition(a.matrixWorld),_b.setFromMatrixPosition(b.matrixWorld),_a.distanceToSquared(_b)}function k(a){let b=[];return a.traverse(function(a){a.isCSS2DObject&&b.push(a)}),b}function l(c){let b=k(c).sort(function(a,b){if(a.renderOrder!==b.renderOrder)return b.renderOrder-a.renderOrder;let c=h.objects.get(a).distanceToCameraSquared,d=h.objects.get(b).distanceToCameraSquared;return c-d}),d=b.length;for(let a=0,e=b.length;a<e;a++)b[a].element.style.zIndex=d-a}b.style.overflow="hidden",this.domElement=b,this.getSize=function(){return{width:d,height:e}},this.render=function(a,b){!0===a.autoUpdate&&a.updateMatrixWorld(),null===b.parent&&b.updateMatrixWorld(),_viewMatrix.copy(b.matrixWorldInverse),_viewProjectionMatrix.multiplyMatrices(b.projectionMatrix,_viewMatrix),i(a,a,b),l(a)},this.setSize=function(a,c){d=a,e=c,f=d/2,g=e/2,b.style.width=a+"px",b.style.height=c+"px"}}}export{CSS2DObject,CSS2DRenderer}